<Window
    x:Class="WPF_Wave.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:helper="clr-namespace:WPF_Wave.Helpers"
    xmlns:local="clr-namespace:WPF_Wave"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:WPF_Wave.Models"
    xmlns:uc="clr-namespace:WPF_Wave.UserControls"
    xmlns:vm="clr-namespace:WPF_Wave.ViewModels"
    Title="VCD Wave"
    Width="1000"
    Height="600"
    d:DataContext="{d:DesignInstance Type=local:MainWindow,
                                     IsDesignTimeCreatable=True}"
    ScrollViewer.CanContentScroll="False"
    mc:Ignorable="d">

    <Window.Resources>
        <helper:BooleanToVisibilityConverter x:Key="BoolToVisibility" />

        <!--  TreeView用のHierarchicalDataTemplate（モジュール名のみ表示）  -->
        <HierarchicalDataTemplate
            x:Key="ModuleTreeTemplate"
            DataType="{x:Type models:ModuleTreeNode}"
            ItemsSource="{Binding Children}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{Binding Name}" />
            </StackPanel>
        </HierarchicalDataTemplate>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Menu Grid.Row="0">
            <MenuItem Header="ファイル">
                <MenuItem Command="{Binding ViewModel.OpenVcdFileCommand}" Header="VCDファイルを開く">
                    <MenuItem.Icon>
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontFamily="Segoe MDL2 Assets"
                            Text="&#xED25;" />
                    </MenuItem.Icon>
                </MenuItem>
                <Separator />
                <MenuItem Header="閉じる">
                    <MenuItem.Icon>
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontFamily="Segoe MDL2 Assets"
                            Text="&#xEF2C;" />
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>

            <MenuItem Command="{Binding ViewModel.ChangeThemeCommand}" Header="テーマ切り替え">
                <MenuItem.Icon>
                    <Grid>
                        <!--  太陽のマーク  -->
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontFamily="Segoe MDL2 Assets"
                            Text="&#xE706;"
                            Visibility="{Binding ViewModel.IsDarkMode, Converter={StaticResource BoolToVisibility}}" />

                        <!--  月のマーク  -->
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontFamily="Segoe MDL2 Assets"
                            Text="&#xE708;"
                            Visibility="{Binding ViewModel.IsLightMode, Converter={StaticResource BoolToVisibility}}" />
                    </Grid>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Command="{Binding ViewModel.ShowLicenseCommand}" Header="ライセンス表示">
                <MenuItem.Icon>
                    <Grid>
                        <!--  書類のマーク  -->
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontFamily="Segoe MDL2 Assets"
                            Text="&#xF000;" />
                    </Grid>
                </MenuItem.Icon>
            </MenuItem>
        </Menu>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid
                x:Name="FoldableContent"
                Width="300"
                HorizontalAlignment="Left">
                <Border
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                    BorderThickness="2.0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!--  モジュール選択ラベル  -->
                        <TextBlock
                            Grid.Row="0"
                            Margin="5"
                            FontWeight="Bold"
                            Text="モジュール選択" />

                        <!--  モジュール選択部  -->
                        <TreeView
                            Grid.Row="1"
                            ItemTemplate="{StaticResource ModuleTreeTemplate}"
                            ItemsSource="{Binding ViewModel.ModuleTree}"
                            SelectedItemChanged="TreeView_SelectedItemChanged" />

                        <!--  仕切り  -->
                        <GridSplitter
                            Grid.Row="2"
                            Height="3"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Center" />

                        <!--  信号選択部ラベルとリスト  -->
                        <Grid Grid.Row="3">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock
                                Grid.Row="0"
                                Margin="5"
                                FontWeight="Bold"
                                Text="信号選択" />

                            <ListView
                                x:Name="SignalsListView"
                                Grid.Row="1"
                                DisplayMemberPath="DisplayText"
                                ItemsSource="{Binding ViewModel.SignalList}"
                                SelectedItem="{Binding ViewModel.SelectedSignal}"
                                SelectionChanged="ListView_SelectionChanged"
                                SelectionMode="Extended" />

                            <WrapPanel
                                Grid.Row="2"
                                Margin="5"
                                HorizontalAlignment="Center"
                                Orientation="Horizontal">
                                <Button
                                    Padding="20,5,20,5"
                                    HorizontalAlignment="Center"
                                    Background="{DynamicResource AccentFillColorDefaultBrush}"
                                    Command="{Binding ViewModel.AddSelectedSignalToWaveformCommand}"
                                    Content="波形に追加"
                                    FontSize="16"
                                    Foreground="{DynamicResource TextOnAccentFillColorPrimaryBrush}" />
                            </WrapPanel>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>

            <Border x:Name="MainContentArea" Grid.Column="1">
                <Button
                    Margin="0,10,0,0"
                    Padding="10"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Top"
                    Click="OnFoldButtonClick">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding FoldButtonArrow}" />
                        <TextBlock Text="モジュールと信号の選択" />

                        <StackPanel.LayoutTransform>
                            <RotateTransform Angle="90" />
                        </StackPanel.LayoutTransform>
                    </StackPanel>
                </Button>
            </Border>

            <Grid Grid.Column="2">
                <!--  Waveform viewer for multiple signals  -->
                <ScrollViewer>
                    <uc:MultiSignalWaveformViewer
                        x:Name="Waveform"
                        Margin="0,5,0,0"
                        VerticalAlignment="Top"
                        LabelBackground="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                        LabelBorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                        LabelDescriptionForeground="{DynamicResource TextFillColorSecondaryBrush}"
                        LabelNameForeground="{DynamicResource TextFillColorPrimaryBrush}"
                        Signals="{Binding ViewModel.SelectedSignalsForWaveform}"
                        TimeAxisTextBrush="{DynamicResource TextFillColorPrimaryBrush}"
                        TimeAxisTickBrush="{DynamicResource TextFillColorPrimaryBrush}"
                        VcdData="{Binding ViewModel.ActiveVcd}" />
                </ScrollViewer>
            </Grid>
        </Grid>
    </Grid>
</Window>